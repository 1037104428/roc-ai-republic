# TODO: install-cn.sh 安装脚本改进计划

**创建时间**: 2026-02-10 19:47:53 CST  
**优先级**: 中  
**状态**: 进行中（智能代理检测已完成）  
**负责人**: 阿爪  
**预计完成时间**: 2026-02-11  

## 概述

当前 `install-cn.sh` 脚本已具备国内可达源优先策略、回退机制、网络诊断和安装验证功能。本TODO文档记录需要进一步改进的功能点，以增强安装脚本的可靠性、用户体验和生产环境适配性。

## 待改进功能列表

### 1. 网络优化策略增强
- [x] **智能代理检测**：自动检测系统代理设置（HTTP_PROXY/HTTPS_PROXY）并适配（完成于2026-02-11）
- [x] **多CDN源测试**：增加对国内多个CDN源的测试，选择最优源（完成于2026-02-11 09:25，创建test-cdn-sources.sh脚本和指南）
- [ ] **连接质量评估**：基于ping时间和下载速度选择最佳源
- [ ] **离线模式支持**：支持从本地缓存安装（当网络完全不可用时）

### 2. 安装流程优化
- [ ] **分步安装模式**：支持分步安装，允许用户选择安装组件
- [ ] **依赖检查增强**：检查Node.js版本、npm权限、磁盘空间等
- [ ] **权限自动修复**：检测并自动修复常见权限问题
- [ ] **安装回滚机制**：安装失败时自动回滚到之前状态

### 3. 用户体验改进
- [ ] **进度条显示**：为长时间操作添加进度条
- [ ] **彩色日志分级**：不同级别的日志使用不同颜色
- [ ] **安装摘要报告**：安装完成后生成详细的安装报告
- [ ] **一键卸载功能**：提供对应的卸载脚本

### 4. 生产环境适配
- [ ] **Docker容器支持**：优化在Docker容器内的安装体验
- [ ] **CI/CD集成**：提供CI/CD友好的安装模式
- [ ] **批量部署支持**：支持在多台服务器上批量部署
- [ ] **配置模板**：提供不同环境（开发/测试/生产）的配置模板

### 5. 监控和维护
- [ ] **安装统计收集**：匿名收集安装成功率统计（可选）
- [ ] **自动更新检查**：安装后自动检查更新
- [ ] **健康检查集成**：与现有的健康检查脚本集成
- [ ] **故障自愈**：检测常见问题并尝试自动修复

## 实施计划

### 第一阶段：网络优化（预计2天）
1. 实现智能代理检测和适配
2. 增加多CDN源测试功能
3. 添加连接质量评估算法

### 第二阶段：安装流程优化（预计3天）
1. 实现分步安装模式
2. 增强依赖检查和权限修复
3. 添加安装回滚机制

### 第三阶段：用户体验改进（预计2天）
1. 添加进度条和彩色日志
2. 实现安装摘要报告
3. 开发一键卸载脚本

### 第四阶段：生产环境适配（预计3天）
1. 优化Docker容器支持
2. 提供CI/CD集成方案
3. 开发批量部署工具

## 验证标准

每个改进完成后需要验证：
1. **功能测试**：在至少3种网络环境下测试（国内直连、代理、离线）
2. **兼容性测试**：在Ubuntu 20.04/22.04、CentOS 7/8、Alpine Linux上测试
3. **性能测试**：安装时间不超过现有版本的120%
4. **错误处理**：模拟各种错误场景，确保优雅降级

## 相关文档

- [install-cn.sh 脚本](../scripts/install-cn.sh)
- [install-cn-strategy.md](install-cn-strategy.md) - 安装策略文档
- [diagnose-network.sh 脚本](../scripts/diagnose-network.sh) - 网络诊断工具
- [verify-openclaw-install.sh 脚本](../scripts/verify-openclaw-install.sh) - 安装验证工具

## 更新记录

| 日期 | 版本 | 修改内容 | 负责人 |
|------|------|----------|--------|
| 2026-02-11 | 1.1 | 完成智能代理检测功能，集成到install-cn.sh | 阿爪 |
| 2026-02-10 | 1.0 | 创建TODO文档 | 阿爪 |

## 备注

本TODO文档将作为 `install-cn.sh` 脚本持续改进的跟踪工具。每个功能点完成后，将更新状态并记录完成时间。