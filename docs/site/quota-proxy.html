<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Clawd 国度 · TRIAL_KEY 获取与使用（quota-proxy）</title>
  <meta name="description" content="Clawd 国度 TRIAL_KEY 获取与使用说明：OpenAI 兼容 Base URL、curl 最小验证、常见错误码、以及 OpenClaw/客户端配置方式。" />
  <link rel="canonical" href="https://clawdrepublic.cn/quota-proxy.html" />
  <style>
    body{max-width:920px;margin:40px auto;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;line-height:1.7;padding:0 16px}
    code,pre{background:#f5f5f5;padding:2px 6px;border-radius:6px}
    pre{padding:12px;overflow:auto}
    h1,h2{line-height:1.2}
    a{color:#0b65c2;text-decoration:none}a:hover{text-decoration:underline}
    .warn{background:#fff7e6;border:1px solid #ffe2a8;padding:10px 12px;border-radius:8px}
    .card{border:1px solid #eee;border-radius:12px;padding:14px 14px;margin:12px 0}
    .muted{color:#666}
  </style>
</head>
<body>
  <h1>TRIAL_KEY 获取与使用（quota-proxy）</h1>
  <p class="muted"><a href="/">返回首页</a> · <a href="/quickstart.html">小白一条龙</a> · <a href="/forum/">论坛</a> · <a href="/downloads.html">下载与镜像</a> · <a href="/status.html">服务状态</a></p>

  <div class="card">
    <h2>这是什么</h2>
    <p>Clawd 国度提供一个 <strong>OpenAI 兼容</strong> 的模型网关：DeepSeek 上游 key 由服务器端持有，不下发给客户端。</p>
    <ul>
      <li>Base URL：<code>https://api.clawdrepublic.cn/v1</code></li>
      <li>健康检查（不消耗额度）：<a href="https://api.clawdrepublic.cn/healthz">https://api.clawdrepublic.cn/healthz</a></li>
    </ul>
  </div>

  <h2>如何获取 TRIAL_KEY（当前：人工发放）</h2>
  <div class="warn">为了避免被滥用，目前先走“人工发放”。后续会上线自助发放，但会保持可运营与可审计。</div>
  <ol>
    <li>到论坛「TRIAL_KEY 申请」发帖：<a href="/forum/t/trial-key">/forum/t/trial-key</a></li>
    <li>建议直接照抄模板：<a href="/forum/d/2-bi-du-trial-key-shen-qing-yu-shi-yong-fu-zhi-nian-tie-ban">《TRIAL_KEY 申请与使用（复制粘贴版）》</a></li>
    <li>管理员私信/回复发放 <code>trial_...</code> 格式的 key</li>
  </ol>

  <h2>最小验证：用 curl 调一次模型</h2>
  <p>把 key 放到环境变量（推荐统一使用 <code>CLAWD_TRIAL_KEY</code>）：</p>
  <pre><code>export CLAWD_TRIAL_KEY="trial_xxx"</code></pre>
  <p>发送一次最小对话请求（看到返回 JSON 含 <code>choices</code> 即可）：</p>
  <pre><code>curl -fsS https://api.clawdrepublic.cn/v1/chat/completions \
  -H "Authorization: Bearer ${CLAWD_TRIAL_KEY}" \
  -H 'content-type: application/json' \
  -d '{
    "model": "deepseek-chat",
    "messages": [{"role":"user","content":"用一句话介绍 Clawd 国度"}]
  }'</code></pre>

  <h2>通用客户端兼容：设置 OpenAI 环境变量</h2>
  <p>很多客户端默认读 <code>OPENAI_API_KEY</code> / <code>OPENAI_BASE_URL</code>：</p>
  <pre><code>export OPENAI_API_KEY="${CLAWD_TRIAL_KEY}"
export OPENAI_BASE_URL="https://api.clawdrepublic.cn/v1"</code></pre>

  <h2>常见错误码（新手必看）</h2>
  <ul>
    <li><code>401</code>/<code>403</code>：TRIAL_KEY 无效/已停用/额度用尽（确认是否贴错、是否有空格）</li>
    <li><code>429</code>：请求过快（请降低频率；或稍等 10-30 秒重试）</li>
    <li><code>5xx</code>：服务端临时故障（稍后再试；也可以去论坛反馈发生时间点）</li>
  </ul>
  <p class="warn"><strong>注意：</strong>不要把任何“真实厂商 Key”（OpenAI/DeepSeek 等）发到论坛。论坛只讨论 TRIAL_KEY。</p>

  <h2>（运维/管理员）发放 TRIAL_KEY 与 /admin/usage 说明</h2>
  <p>管理接口不应暴露公网；一般在服务器本机（或内网）执行 curl。</p>

  <h3>1) 生成（发放）一个 TRIAL_KEY</h3>
  <pre><code>export ADMIN_TOKEN='***'
curl -fsS -X POST http://127.0.0.1:8787/admin/keys \
  -H "Authorization: Bearer ${ADMIN_TOKEN}" \
  -H 'content-type: application/json' \
  -d '{"label":"forum-user:alice"}'</code></pre>
  <p>返回示例：</p>
  <pre><code>{"key":"trial_xxx","label":"forum-user:alice","created_at":1700000000000}</code></pre>

  <h3>2) 查询用量（按天聚合）</h3>
  <pre><code>curl -fsS "http://127.0.0.1:8787/admin/usage?day=$(date +%F)" \
  -H "Authorization: Bearer ${ADMIN_TOKEN}"</code></pre>

  <p>典型返回：</p>
  <pre><code>{
  "day": "2026-02-08",
  "mode": "file",
  "items": [
    { "key": "trial_xxx", "req_count": 12, "updated_at": 1700000000000 }
  ]
}</code></pre>

  <hr />
  <p class="muted">仓库：<a href="https://github.com/1037104428/roc-ai-republic">roc-ai-republic</a></p>
</body>
</html>
