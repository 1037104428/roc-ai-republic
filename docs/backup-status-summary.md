# å¤‡ä»½çŠ¶æ€æ‘˜è¦è„šæœ¬

## æ¦‚è¿°

`backup-status-summary.sh` è„šæœ¬æä¾›æ•°æ®åº“å¤‡ä»½ç³»ç»Ÿçš„å¿«é€ŸçŠ¶æ€æ¦‚è§ˆï¼Œå¸®åŠ©ç®¡ç†å‘˜å¿«é€Ÿäº†è§£å¤‡ä»½ç³»ç»Ÿçš„æ•´ä½“å¥åº·çŠ¶å†µã€‚

## åŠŸèƒ½ç‰¹æ€§

- âœ… **æœ¬åœ°è„šæœ¬æ£€æŸ¥**: éªŒè¯æ‰€æœ‰å¤‡ä»½ç›¸å…³è„šæœ¬çš„å­˜åœ¨æ€§å’Œå¯æ‰§è¡Œæ€§
- âœ… **æœåŠ¡å™¨çŠ¶æ€æ£€æŸ¥**: æ£€æŸ¥æœåŠ¡å™¨è¿æ¥å’Œå¤‡ä»½ç›®å½•çŠ¶æ€
- âœ… **å¤‡ä»½æ–‡ä»¶ç»Ÿè®¡**: ç»Ÿè®¡æœåŠ¡å™¨ä¸Šçš„å¤‡ä»½æ–‡ä»¶æ•°é‡å’Œæ—¶é—´
- âœ… **æ‘˜è¦æŠ¥å‘Šç”Ÿæˆ**: ç”Ÿæˆæ ¼å¼åŒ–çš„çŠ¶æ€æ‘˜è¦æŠ¥å‘Š
- âœ… **å»ºè®®æ“ä½œ**: æä¾›åŸºäºå½“å‰çŠ¶æ€çš„å»ºè®®æ“ä½œ
- âœ… **å¿«é€Ÿå‘½ä»¤**: åˆ—å‡ºå¸¸ç”¨çš„å¤‡ä»½ç®¡ç†å‘½ä»¤

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ä½¿ç”¨

```bash
# æ ‡å‡†æ¨¡å¼è¿è¡Œ
./scripts/backup-status-summary.sh

# æ¨¡æ‹Ÿè¿è¡Œï¼ˆä¸æ‰§è¡Œå®é™…å‘½ä»¤ï¼‰
./scripts/backup-status-summary.sh --dry-run

# è¯¦ç»†è¾“å‡ºæ¨¡å¼
./scripts/backup-status-summary.sh --verbose

# å®‰é™æ¨¡å¼ï¼ˆåªè¾“å‡ºå…³é”®ä¿¡æ¯ï¼‰
./scripts/backup-status-summary.sh --quiet

# æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
./scripts/backup-status-summary.sh --help
```

### è¾“å‡ºç¤ºä¾‹

```
[INFO] å¼€å§‹å¤‡ä»½çŠ¶æ€æ‘˜è¦æ£€æŸ¥...

[INFO] æ£€æŸ¥æœ¬åœ°å¤‡ä»½è„šæœ¬...
æœ¬åœ°è„šæœ¬ç»Ÿè®¡:
  - æ€»è®¡è„šæœ¬: 5
  - å­˜åœ¨ä¸”å¯æ‰§è¡Œ: 5
  - ç¼ºå¤±: 0

[INFO] æ£€æŸ¥æœåŠ¡å™¨å¤‡ä»½çŠ¶æ€...
[INFO] æ£€æŸ¥æœåŠ¡å™¨è¿æ¥...
[SUCCESS] æœåŠ¡å™¨è¿æ¥æ­£å¸¸
[INFO] æ£€æŸ¥æœåŠ¡å™¨å¤‡ä»½ç›®å½•...
[SUCCESS] æœåŠ¡å™¨å¤‡ä»½ç›®å½•å­˜åœ¨
æœåŠ¡å™¨å¤‡ä»½ç»Ÿè®¡:
  - å¤‡ä»½æ–‡ä»¶æ•°é‡: 3
  - æœ€æ–°å¤‡ä»½: quota-backup-2026-02-10_16-30-00.db.gz
  - å¤‡ä»½æ—¶é—´: 2026-02-10 16:30:05.000000000 +0800

[INFO] ç”Ÿæˆå¤‡ä»½çŠ¶æ€æ‘˜è¦æŠ¥å‘Š...
========================================
å¤‡ä»½çŠ¶æ€æ‘˜è¦æŠ¥å‘Š
ç”Ÿæˆæ—¶é—´: 2026-02-10 16:45:30
========================================

ğŸ“Š ç³»ç»ŸçŠ¶æ€æ¦‚è§ˆ
  - æœ¬åœ°å¤‡ä»½è„šæœ¬: å®Œæ•´
  - æœåŠ¡å™¨è¿æ¥: å·²é…ç½®
  - å¤‡ä»½ç›®å½•: å­˜åœ¨

ğŸ”§ å»ºè®®æ“ä½œ
  1. å®šæœŸè¿è¡Œå¤‡ä»½éªŒè¯: ./scripts/verify-db-backup.sh
  2. æ£€æŸ¥æœåŠ¡å™¨å¤‡ä»½çŠ¶æ€: ./scripts/check-server-backup-status.sh
  3. æµ‹è¯•å¤‡ä»½æ¢å¤åŠŸèƒ½: ./scripts/test-db-backup-recovery.sh --dry-run

ğŸ“ å¿«é€Ÿå‘½ä»¤
  # æŸ¥çœ‹è¯¦ç»†å¤‡ä»½çŠ¶æ€
  ./scripts/check-server-backup-status.sh --verbose

  # éªŒè¯å¤‡ä»½ç³»ç»Ÿå®Œæ•´æ€§
  ./scripts/verify-db-backup.sh

  # è®¾ç½®å®šæ—¶å¤‡ä»½ä»»åŠ¡
  sudo ./scripts/setup-db-backup-cron.sh

========================================
[SUCCESS] å¤‡ä»½çŠ¶æ€æ‘˜è¦æ£€æŸ¥å®Œæˆ
```

## æ£€æŸ¥å†…å®¹

### 1. æœ¬åœ°å¤‡ä»½è„šæœ¬æ£€æŸ¥

è„šæœ¬ä¼šæ£€æŸ¥ä»¥ä¸‹å…³é”®å¤‡ä»½è„šæœ¬ï¼š

| è„šæœ¬æ–‡ä»¶ | åŠŸèƒ½æè¿° |
|----------|----------|
| `backup-sqlite-db.sh` | æ•°æ®åº“å¤‡ä»½è„šæœ¬ |
| `setup-db-backup-cron.sh` | cronå®šæ—¶ä»»åŠ¡è®¾ç½®è„šæœ¬ |
| `verify-db-backup.sh` | å¤‡ä»½éªŒè¯è„šæœ¬ |
| `test-db-backup-recovery.sh` | å¤‡ä»½æ¢å¤æµ‹è¯•è„šæœ¬ |
| `check-server-backup-status.sh` | æœåŠ¡å™¨å¤‡ä»½çŠ¶æ€æ£€æŸ¥è„šæœ¬ |

### 2. æœåŠ¡å™¨å¤‡ä»½çŠ¶æ€æ£€æŸ¥

- **æœåŠ¡å™¨è¿æ¥**: ä½¿ç”¨SSHå¯†é’¥æ£€æŸ¥æœåŠ¡å™¨å¯è¾¾æ€§
- **å¤‡ä»½ç›®å½•**: æ£€æŸ¥ `/opt/roc/quota-proxy/backups/` ç›®å½•æ˜¯å¦å­˜åœ¨
- **å¤‡ä»½æ–‡ä»¶**: ç»Ÿè®¡å¤‡ä»½æ–‡ä»¶æ•°é‡å’Œæ—¶é—´ä¿¡æ¯

### 3. æ‘˜è¦æŠ¥å‘Š

æŠ¥å‘ŠåŒ…å«ï¼š
- ç³»ç»ŸçŠ¶æ€æ¦‚è§ˆ
- åŸºäºå½“å‰çŠ¶æ€çš„å»ºè®®æ“ä½œ
- å¸¸ç”¨å‘½ä»¤å¿«é€Ÿå‚è€ƒ

## é›†æˆå»ºè®®

### å®šæœŸè¿è¡Œ

å»ºè®®å°†å¤‡ä»½çŠ¶æ€æ‘˜è¦æ£€æŸ¥é›†æˆåˆ°æ—¥å¸¸ç›‘æ§ä¸­ï¼š

```bash
# æ¯å¤©è¿è¡Œä¸€æ¬¡å¤‡ä»½çŠ¶æ€æ£€æŸ¥
0 9 * * * /path/to/roc-ai-republic/scripts/backup-status-summary.sh --quiet > /var/log/backup-status.log
```

### ä¸å…¶ä»–è„šæœ¬é…åˆ

```bash
# å®Œæ•´çš„å¤‡ä»½ç³»ç»Ÿæ£€æŸ¥æµç¨‹
./scripts/backup-status-summary.sh
./scripts/verify-db-backup.sh
./scripts/check-server-backup-status.sh --verbose
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æœåŠ¡å™¨è¿æ¥å¤±è´¥**
   - æ£€æŸ¥ `/tmp/server.txt` é…ç½®æ–‡ä»¶
   - éªŒè¯SSHå¯†é’¥æƒé™ (`~/.ssh/id_ed25519_roc_server`)
   - ç¡®è®¤æœåŠ¡å™¨ç½‘ç»œå¯è¾¾æ€§

2. **å¤‡ä»½ç›®å½•ä¸å­˜åœ¨**
   - ç¡®ä¿å¤‡ä»½è„šæœ¬å·²æˆåŠŸè¿è¡Œ
   - æ£€æŸ¥æœåŠ¡å™¨ä¸Šç›®å½•æƒé™

3. **è„šæœ¬ä¸å¯æ‰§è¡Œ**
   - è¿è¡Œ `chmod +x scripts/*.sh` ä¿®å¤æƒé™

### è°ƒè¯•æ¨¡å¼

```bash
# å¯ç”¨è¯¦ç»†è¾“å‡º
./scripts/backup-status-summary.sh --verbose

# ç»“åˆå…¶ä»–è°ƒè¯•å·¥å…·
bash -x ./scripts/backup-status-summary.sh --dry-run
```

## ç›¸å…³æ–‡æ¡£

- [æ•°æ®åº“å¤‡ä»½ç³»ç»Ÿ](./sqlite-db-backup-system.md) - å®Œæ•´çš„å¤‡ä»½ç³»ç»Ÿæ¶æ„
- [æœåŠ¡å™¨å¤‡ä»½çŠ¶æ€æ£€æŸ¥](./backup-status-check.md) - è¯¦ç»†çš„æœåŠ¡å™¨å¤‡ä»½ç›‘æ§
- [å¤‡ä»½éªŒè¯æŒ‡å—](./db-backup-verification.md) - å¤‡ä»½å®Œæ•´æ€§éªŒè¯æ–¹æ³•

---

**æ›´æ–°æ—¥å¿—**
- 2026-02-10: åˆå§‹åˆ›å»ºï¼Œæä¾›å¤‡ä»½ç³»ç»Ÿå¿«é€ŸçŠ¶æ€æ¦‚è§ˆåŠŸèƒ½